<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Juego Dominó - IBK</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
            display: flex;
        }

        #instrucciones {
            width: 300px;
            margin-right: 20px;
        }

        .titulo {
            color: #004d40; /* verde oscuro */
            font-weight: bold;
        }

        .descripcion {
            color: #80cbc4; /* verde claro */
            margin-bottom: 10px;
        }

        #tablero {
            width: 1000px;
            height: 600px;
            position: relative;
            background-color: #ffffff;
            border: 2px solid #ccc;
            border-radius: 10px;
        }

        .casilla {
            width: 80px;
            height: 80px;
            border: 2px dashed #999;
            position: absolute;
            background-color: #e9e9e9;
            border-radius: 10px;
        }

        .cartilla {
            width: 80px;
            height: 80px;
            position: absolute;
            cursor: grab;
            border-radius: 10px;
            transition: all 0.2s ease;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }

        #mensaje-final {
            position: absolute;
            top: 40%;
            left: 30%;
            font-size: 48px;
            color: green;
            font-weight: bold;
            display: none;
        }
    </style>
</head>
<body>
    <div id="instrucciones">
        <h2 class="titulo">Instrucciones</h2>
        <p class="descripcion">Une cada <span style="color: #004d40;">valor</span> con su <span style="color: #80cbc4;">comportamiento</span> correcto.</p>
        <p class="descripcion">Arrastra las piezas al tablero y colócalas en la casilla correspondiente.</p>
    </div>

    <div id="tablero">
        <div id="mensaje-final">¡Ganaste!</div>

        <!-- Casillas -->
        <!-- Letra I -->
        <div class="casilla" id="I1" style="top: 60px; left: 80px;"></div>
        <div class="casilla" id="I2" style="top: 240px; left: 80px;"></div>
        <div class="casilla" id="I3" style="top: 420px; left: 80px;"></div>

        <!-- Letra B -->
        <div class="casilla" id="B1" style="top: 60px; left: 300px;"></div>
        <div class="casilla" id="B4" style="top: 70px; left: 400px;"></div>
        <div class="casilla" id="B7" style="top: 155px; left: 430px;"></div>
        <div class="casilla" id="B2" style="top: 240px; left: 300px;"></div>
        <div class="casilla" id="B5" style="top: 240px; left: 400px;"></div>
        <div class="casilla" id="B8" style="top: 325px; left: 430px;"></div>
        <div class="casilla" id="B3" style="top: 420px; left: 300px;"></div>
        <div class="casilla" id="B6" style="top: 410px; left: 400px;"></div>

        <!-- Letra K -->
        <div class="casilla" id="K1" style="top: 60px; left: 580px;"></div>
        <div class="casilla" id="K2" style="top: 240px; left: 580px;"></div>
        <div class="casilla" id="K3" style="top: 420px; left: 580px;"></div>
        <div class="casilla" id="K4" style="top: 60px; left: 740px;"></div>
        <div class="casilla" id="K5" style="top: 150px; left: 660px;"></div>
        <div class="casilla" id="K6" style="top: 330px; left: 660px;"></div>
        <div class="casilla" id="K7" style="top: 420px; left: 740px;"></div>

        <!-- Cartillas -->
        <script>
            const piezas = ['I1','I2','I3','B1','B2','B3','B4','B5','B6','B7','B8','K1','K2','K3','K4','K5','K6','K7'];
            const posiciones = [
                [50, 800], [150, 900], [250, 850], [350, 950],
                [450, 780], [550, 870], [100, 50], [200, 150],
                [300, 30], [400, 950], [500, 850], [600, 920],
                [130, 1000], [230, 890], [330, 910], [430, 1030],
                [530, 970], [630, 880]
            ];
            piezas.forEach((letra, i) => {
                document.write(`<img src="static/img/${letra}.png" id="${letra}" class="cartilla" style="top: ${posiciones[i][0]}px; left: ${posiciones[i][1]}px;">`);
            });
        </script>
    </div>

    <script>
        const posicionesCorrectas = {
            I1: [80, 60], I2: [80, 240], I3: [80, 420],
            B1: [300, 60], B4: [400, 70],
            B7: [430, 155], B2: [300, 240], B5: [400, 240],
            B8: [430, 325], B3: [300, 420], B6: [400, 410],
            K1: [580, 60], K2: [580, 240], K3: [580, 420],
            K4: [740, 60], K5: [660, 150], K6: [660, 330], K7: [740, 420]
        };

        const piezasCorrectas = new Set();

        document.querySelectorAll('.cartilla').forEach(cartilla => {
            let offsetX, offsetY, startX, startY;

            cartilla.addEventListener('mousedown', e => {
                startX = cartilla.offsetLeft;
                startY = cartilla.offsetTop;
                offsetX = e.clientX - cartilla.offsetLeft;
                offsetY = e.clientY - cartilla.offsetTop;

                const onMouseMove = e => {
                    cartilla.style.left = (e.clientX - offsetX) + 'px';
                    cartilla.style.top = (e.clientY - offsetY) + 'px';
                };

                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);

                    const [correctX, correctY] = posicionesCorrectas[cartilla.id];
                    const dx = Math.abs(cartilla.offsetLeft - correctX);
                    const dy = Math.abs(cartilla.offsetTop - correctY);

                    if (dx < 40 && dy < 40) {
                        cartilla.style.left = correctX + 'px';
                        cartilla.style.top = correctY + 'px';
                        cartilla.style.pointerEvents = "none";
                        piezasCorrectas.add(cartilla.id);

                        if (piezasCorrectas.size === Object.keys(posicionesCorrectas).length) {
                            document.getElementById('mensaje-final').style.display = 'block';

                            // Registrar ganador
                            fetch('casillas/registrar_ganador.json', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ ganador: "Jugador", timestamp: new Date().toISOString() })
                            });
                        }

                        alert("¡Correcto!");
                    } else {
                        cartilla.style.left = startX + 'px';
                        cartilla.style.top = startY + 'px';
                    }
                };

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
        });
    </script>
</body>
</html>
